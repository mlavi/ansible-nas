# shellcheck shell=bash

direnv.extension.mlavi.create_env

dotenv_if_exists || direnv status # https://direnv.net/man/direnv-stdlib.1.html
dotenv_if_exists .env.mlavi.homelab.sample
# dotenv_if_exists .env.troubleshooting.sample
direnv.extension.mlavi.git_repo

diff nas.yml nas-mlavi.homelab.yaml

cat <<- 'MotD'
- How to confirm proper release? in /requirements.yml
  - ansible-galaxy install -r requirements.yml
    - ~/.ansible/roles/geerlingguy.docker/meta/.galaxy_install_info
    https://galaxy.ansible.com/ui/standalone/roles/geerlingguy/docker
    https://github.com/geerlingguy/ansible-role-docker
  - Lifecycle
    TODO: ansible-galaxy collection install vladgh.samba --upgrade && ansible-galaxy collection list
    https://docs.ansible.com/ansible/latest/collections_guide/index.html

    ansible-galaxy role list
    ansible-galaxy role info geerlingguy.docker | grep install
    ansible-galaxy role remove geerlingguy.docker && ansible-galaxy role list
    ansible-galaxy role install geerlingguy.docker
  - versus: ssh ansible-nas sudo su ansible
    # cd ~ansible && curl -fsSL get.docker.com -o get-docker.sh && sh get-docker.sh
    # To run Docker as a non-privileged user, consider setting up the
    # Docker daemon in rootless mode for your user:
    #  dockerd-rootless-setuptool.sh install
    # Visit https://docs.docker.com/go/rootless/ to learn about rootless mode.
    # To run the Docker daemon as a fully privileged service, but granting non-root
    # users access, refer to https://docs.docker.com/go/daemon-access/
    # sudo usermod -aG docker ansible && docker info

ansible-playbook nas.yml --limit nas --start-at-task=homeassistant* # --list-tags
ansible-playbook nas-mlavi.homelab.yaml --start-at-task=ansible-nas-docker*
ANSIBLE_SKIP_TAGS+=', jellyfin, homeassistant' ansible-playbook --limit pi \
  mlavi.yaml nas-mlavi.homelab.yaml --start-at-task=mlavi.homelab.homeassistant*

MotD

# direnv.extension.mlavi.autostart
direnv.extension.mlavi.readme requirements-mlavi.homelab.yaml
